# TrafficLights

## Алгоритм работы программы
В основу решения положен критерий суммарного времени ожидания очереди.

Цикл алгоритма делится на два этапа: определение светофоров, которым требуется включение зеленого света, и проверка возможности переключения света для текущей ситуации на перекрестке.


### Первый этап (события ```Update``` и ```Check```)
Светофоры отправляют друг другу сообщения со своим номером ```ID``` и суммарным временем ожидания всех участников движения на своём направлении ```QueueWaitingTimeSum```. 
Если один светофор получает сообщение о том, что у другого время ожидания больше, он переключает свой статус ```IsGreenNeeded``` в значение ```false```. В случае если время ожидания другого больше, но направления движений не пересекаются, ```IsGreenNeeded``` остётся true. 
Затем все светофоры, которые имеют значение ```IsGreenNeeded``` ```true```, проверяют пересекаются ли их направления и, если пересекаются, переключают ```IsGreenNeeded``` в значение ```false```.
 
### Второй этап (события ```VehiclePass``` и ```PedestrianPass```)
Вначале определяется, какие автомобильные светофоры могут переключить свет. Для определения возможности переключения света используется метод ```SolveInput``` класса ```ColorSwitch```.
Затем пешеходные светофоры переключают свет. В этом же событии все светофоры, у которых значение IsMovmentAllowed равно true уменьшают очередь участников движения на один.

## Иерархия классов
![image](https://github.com/user-attachments/assets/116ac013-ed8b-4ccd-a4ce-26405d4ad252)

Центральный объект - светофор представлен в программе абстрактным классом ```TrafficLightBase``` от которого наследуются ```VehicleTrafficLight``` и ```PedestrianTrafficLight```. 
![image](https://github.com/user-attachments/assets/cd0c78e5-2ff2-4bb7-9d56-99bee49ecb44)

Экземпляры классов ```VehicleTrafficLight``` и ```PedestrianTrafficLight``` связаны с наследниками класса ```ColorSwitchBase``` композицией (паттерн фабрика).

```ColorSwitchBase``` определяет поведение при переключении цветов для пешеходов и автомобилей (```PedestrianColorSwitch``` и ```VehicleColorSwitch``` соответственно). 

Также экземпляры классов ```VehicleTrafficLight``` и ```PedestrianTrafficLight``` имеют коллекцию ```Queue``` участников движения, которые находятся в ожидании данного светофора.

Участники движения представлены наследниками класса ```TrafficParticipantsBase```:  ```Pedestrian``` и ```Vehicle``` - пешеход и транспорт соответственно.

Ход программы обеспечивает метод ```Start``` класса ```Crossroad```, запускающий цикл, в котором поэтапно вызываются события ```Update, Check, VehiclePass, PedestrianPass```. После того, как события обработаются, сгенерируются новые участники дорожного движения, которые случайным образом добавляются в конец очереди случайно выбранных светофоров.
![image](https://github.com/user-attachments/assets/ca8902f9-78ab-4327-8d58-89de470139e8)
